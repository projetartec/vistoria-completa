rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /inspections/{inspectionId} {
      // Allow reading a single document only if the user is the owner
      allow get: if request.auth != null && resource.data.owner == request.auth.token.name;
      
      // Allow creating, updating, deleting only if the user is the owner
      allow write: if request.auth != null && request.resource.data.owner == request.auth.token.name;
    }
    
    // Allow listing documents if the user is authenticated. 
    // The client-side query MUST enforce that the user only sees their own documents.
    match /inspections {
      allow list: if request.auth != null;
    }
  }
}
